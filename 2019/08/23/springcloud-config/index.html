<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.4"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.4"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><title>Spring Cloud（二）配置中心 | 微言术语</title></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Spring Cloud（二）配置中心</h1><a id="logo" href="/.">微言术语</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Spring Cloud（二）配置中心</h1><div class="post-meta"><a href="/2019/08/23/springcloud-config/#comments" class="comment-count"></a><p><span class="date">Aug 23, 2019</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>在微服务项目中，如果说注册中心是管理者，那么配置中心就是户口簿。它记录着微服务体系中，各个模块的信息。</p>
<h1 id="云配置"><a href="#云配置" class="headerlink" title="云配置"></a>云配置</h1><p>Spring Cloud Config 是一套为分布式系统中的基础设施和微服务应用提供集中化配置的管理方案，它分为服务端与客户端两个部分：</p>
<ul>
<li>服务端也称为分布式配置中心，它是一个独立的微服务应用，用来连接配置仓库并为客户端提供配置信息。</li>
<li>客户端则是微服务架构中的各个微服务应用或基础设施，它们通过指定的配置中心来管理服务相关的配置内容，并在启动的时候从配置中心获取和加载配置信息。</li>
</ul>
<p>在微服务的体系中，为了便于对多个微服务应用的配置进行管理，可以基于Spring Cloud Config构建配置中心，便于配置文件的统一修改、分发以及版本管理。</p>
<p><em>特点</em></p>
<ul>
<li>抽象映射，,通用性好。</li>
<li>默认使用git存储，支持版本管理</li>
</ul>
<blockquote>
<p>虽然Git可以进行托管，但是在正式的开发环境中，需要放置到服务器上</p>
</blockquote>
<p><em>配置文件的启动顺序</em><br>配置文件的优先规则也与常规启动应用程序相同：</p>
<ul>
<li>活动配置文件优先于默认配置文件；</li>
<li>如果有多个配置文件，则引用最后一个配置文件。</li>
</ul>
<h2 id="Spring-Cloud-Config支持本地存储"><a href="#Spring-Cloud-Config支持本地存储" class="headerlink" title="Spring Cloud Config支持本地存储"></a>Spring Cloud Config支持本地存储</h2><p>spring.profiles.active=native，Config Server会默认从应用的src/main/resource目录下检索配置文件。<br>另外也可以通过spring.cloud.config.server.native.searchLocations=file:D:/properties/属性来指定配置文件的位置</p>
<h2 id="分布式配置中心"><a href="#分布式配置中心" class="headerlink" title="分布式配置中心"></a>分布式配置中心</h2><h3 id="需要的包"><a href="#需要的包" class="headerlink" title="需要的包"></a>需要的包</h3><ul>
<li>spring核心</li>
<li>Spring Cloud</li>
<li>Spring Cloud Config</li>
</ul>
<p><em>使用步骤</em></p>
<ol>
<li>构建项目，推荐使用IDEA的Spring initializr</li>
<li>开启配置服务支持，@EnableConfigServer</li>
<li>在yml添加如下配置</li>
</ol>
<h4 id="Application-yml"><a href="#Application-yml" class="headerlink" title="Application.yml"></a>Application.yml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 9901</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: spring-cloud-config-server</span><br><span class="line">  profiles: #默认从应用的src/main/resource目录下检索配置文件</span><br><span class="line">    active: native #读取本地文件</span><br><span class="line">  cloud:</span><br><span class="line">    config:</span><br><span class="line">      server:</span><br><span class="line">        native:</span><br><span class="line">          search-locations: file:/E://wsz6672/bdqy/eboss/config-repo/config #重设本地文件的路径</span><br><span class="line">        bootstrap: true</span><br><span class="line">#        git: # 使用git的数据源</span><br><span class="line">#          uri: file://gitee.com/liuge1988/spring-cloud-demo/         # 配置git仓库的地址</span><br><span class="line">#          search-paths: config-repository                             # git仓库地址下的相对地址，可以配置多个，用,分割。</span><br><span class="line">#          username: username                                          # git仓库的账号</span><br><span class="line">#          password: password</span><br></pre></td></tr></table></figure>

<blockquote>
<p>search-locations：file://${user.home}/config-repo，${user.home}可以是git仓库的地址或者是本地的地址。</p>
</blockquote>
<p>入口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication //开启服务</span><br><span class="line">@EnableConfigServer //启用配置服务器</span><br><span class="line">public class ScfApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(ScfApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端进行资源请求的规则如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">• /&#123;application&#125;/&#123;profile&#125;[/&#123;label&#125;]</span><br><span class="line">• /&#123;application&#125;-&#123;profile&#125;.yml</span><br><span class="line">• /&#123;label&#125;/&#123;application&#125;-&#123;profile&#125;.yml</span><br><span class="line">• /&#123;application&#125;-&#123;profile&#125;.properties</span><br><span class="line">/&#123;label&#125;/&#123;application&#125;-&#123;profile&#125;.properties</span><br></pre></td></tr></table></figure>

<ul>
<li>其中application是配置文件名称，映射到客户端的spring.application.name；</li>
<li>profile是属性，映射到客户端的spring.active.profiles，可以用逗号分割。Profile 分为dev test  prod ，有默认、开发、测试、产品四个级别</li>
<li>label是配置的版本号，git中默认是master，如果包含特殊字符，需要用“_”分割</li>
</ul>
<h2 id="配置中心客户端"><a href="#配置中心客户端" class="headerlink" title="配置中心客户端"></a>配置中心客户端</h2><p>这里，不做过多介绍，专注于配置与使用。</p>
<h3 id="pom导包"><a href="#pom导包" class="headerlink" title="pom导包"></a>pom导包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Boostrap-yml"><a href="#Boostrap-yml" class="headerlink" title="Boostrap.yml"></a>Boostrap.yml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 1114</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: zhny-base #读取配置的名称</span><br><span class="line">  cloud:</span><br><span class="line">    config:</span><br><span class="line">       #uri: localhost:1113</span><br><span class="line">      profile: dev #读取配置的版本号</span><br><span class="line">      discovery:</span><br><span class="line">        enabled: true #默认直接查找配置中心，配置后通过注册中心找配置中心再获取配置</span><br><span class="line">        service-id: config-cloud #配置中心的名字，可以在配置中心集群时实现负载均衡</span><br><span class="line">#注册到注册中心</span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    serviceUrl:</span><br><span class="line">      defaultZone: http://localhost:1110/eureka/ #注册中心的域名</span><br></pre></td></tr></table></figure>

<h3 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class TestController &#123;</span><br><span class="line">    @Value(value = &quot;$&#123;common.org_id&#125;&quot;)</span><br><span class="line">    private String org_id;</span><br><span class="line">    @RequestMapping(&quot;/&quot;)</span><br><span class="line">    public String test () &#123;</span><br><span class="line">        if (org_id.isEmpty()) &#123;</span><br><span class="line">            return &quot;error&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        return org_id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="属性覆盖"><a href="#属性覆盖" class="headerlink" title="属性覆盖"></a>属性覆盖</h2><p>用途：在实际开发中，多个分布式系统可能使用同一套公有的配置文件，但有些属性的参数值是当前系统所不匹配的，通过这个配置就可以在公有配置文件的基础上进行调整。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    config:</span><br><span class="line">      server:</span><br><span class="line">        overrides:</span><br><span class="line">          foo: bar</span><br></pre></td></tr></table></figure>

<h2 id="Health指标"><a href="#Health指标" class="headerlink" title="Health指标"></a>Health指标</h2><p>Config Server附带一个运行状况指示器，用于检查配置的EnvironmentRepository是否正常工作。默认情况下，它会向EnvironmentRepository询问名为app的应用程序，默认配置文件以及EnvironmentRepository实现提供的默认标签。<br>您可以通过设置<em>spring.cloud.config.server.health.enabled = false</em>来禁用运行状况指示器。</p>
<h2 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h2><p>您可以以任何对您有意义的方式（从物理网络安全到OAuth2承载令牌）自由地保护您的Config服务器，而Spring Security和Spring Boot可以轻松完成任何操作。<br>要使用默认的Spring Boot配置的HTTP Basic安全性，只需在类路径中包含Spring Security（例如，通过spring-boot-starter-security）。默认值是“user”的用户名和随机生成的密码，这在实践中不会非常有用，因此我们建议您配置密码（通过security.user.password）并加密。</p>
</div><div class="post-copyright"><blockquote><p>原文作者: wsz</p><p>原文链接: <a href="http://aixf.club/2019/08/23/springcloud-config/">http://aixf.club/2019/08/23/springcloud-config/</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"><a href="/tags/Spring-Cloud/">Spring Cloud</a><a href="/tags/微服务/">微服务</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/2019/08/23/springcloud-context/" class="next">Spring Cloud（一）上下文服务</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#云配置"><span class="toc-text">云配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Cloud-Config支持本地存储"><span class="toc-text">Spring Cloud Config支持本地存储</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分布式配置中心"><span class="toc-text">分布式配置中心</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#需要的包"><span class="toc-text">需要的包</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Application-yml"><span class="toc-text">Application.yml</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置中心客户端"><span class="toc-text">配置中心客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pom导包"><span class="toc-text">pom导包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Boostrap-yml"><span class="toc-text">Boostrap.yml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#控制器"><span class="toc-text">控制器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#属性覆盖"><span class="toc-text">属性覆盖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Health指标"><span class="toc-text">Health指标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Security"><span class="toc-text">Security</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/08/23/springcloud-config/">Spring Cloud（二）配置中心</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/23/springcloud-context/">Spring Cloud（一）上下文服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/20/swagger-base/">swagger(一)基础入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/20/blog-md-command/">博客搭建（三）Markdown的常用命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/20/maven-move-repository/">maven迁移仓库</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/19/build-blog-two/">博客搭建（二）hexo的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/18/first/">博客搭建（一）Github Page</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/博客搭建/" style="font-size: 15px;">博客搭建</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/Spring-Cloud/" style="font-size: 15px;">Spring Cloud</a> <a href="/tags/微服务/" style="font-size: 15px;">微服务</a> <a href="/tags/swagger/" style="font-size: 15px;">swagger</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">wsz.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.4"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.4" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script></body></html>