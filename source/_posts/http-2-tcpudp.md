---
title: 计算机网络（一） TCP,UDP
date: 2020-04-02 15:41:32
tags: [http]
---

TCP协议与UDP协议都属于`运输层`协议。


运输层负责端到端的通信，既是七层模型中负责数据通信的最高层，又是面向网络通信的低三层和面向信息处理的最高三层之间的中间层。运输层位于网络层之上、会话层之下，它利用网络层子系统提供给它的服务去开发本层的功能，并实现本层对会话层的服务。

***

# TCP协议 

TCP是一种面向连接了，提供可靠的数据运输协议。它可为用户进程提供可靠的全双工字节流。这样，可以保证数据包的可靠有序，并可以支持流量控制。

***为什么需要TCP协议***
在五层协议中，物理层与数据链路层是负责实际的数据运输，而网络层负责数据的寻址与路由。网络层可以找到最佳的信息传输路径，但不能保证数据包的可靠性。在网络拥塞的情况下，某些数据包将被丢弃以确保数据传输效率。所以，我们需要TCP协议确保数据的可靠运输。
 
***TCP数据包的组成***
许多网络具有最大传输单位（MTU），这是对链路层中数据帧的限制。例如，以太网上的MTU1,500字节。IP数据报通过以太网传输。如果其长度大于MTU值，则必须以分片形式传输它，以便每个分片的长度小于MTU。

而TCP数据包的大小由MSS值来确定，MSS是TCP中的一个概念（在标题的选项字段中）。MSS是TCP数据包每次可以传输的最大数据段。当TCP数据包的长度大于MSS时，必须分段传输。如果未设置MSS，则默认值为536字节。也就是说，TCP数据包约为500字节。

![TCP数据包的组成](/image/http/http-1-tcp.png)


***确保可靠性***
首先，为了确保数据包的完整性，默认MSS为563字节，比MUT小，以防止在网络层被分片。
其次，加入`SEQ`和`ACK`，并采用超时重传机制，以保证报文的可靠性。

`序列号(SEQ)`：为了确保数据包的有序性，TCP为每个数据包分配一个序列号（SEQ）。这样，接收方可以按顺序恢复数据包。在丢包的情况下，也可能知道哪个包丢失了。通常，第一个数据包的SEQ是一个随机数，也可以从1开始。

`确认(ACK)`：每次接收到数据包时，接收方必须返回一个ACK，以便发送方可以确认该数据包已被发送，发送方不能跳着确认。如果在验证过程中发现错误，则不会发送任何ACK，从而触发发送方超时重传。

`ACK`包含的信息：
+	预期要接收的下一个数据包的SEQ
+	接收窗口的剩余容量


***超时重传***

超时重传是TCP协议保证数据可靠性的另一个重要机制，其原理是在发送某一个数据以后就开启一个计时器，在一定时间内如果没有得到发送的数据报的ACK报文，那么就重新发送数据，直到发送成功为止。

+	影响超时重传机制协议效率的一个关键参数是重传超时时间（RTO，Retransmission TimeOut）。RTO的值被设置过大过小都会对协议造成不利影响。
+	对一个连接而言，若能够了解端点间的传输往返时间（RTT，Round Trip Time），则可根据RTT来设置一合适的RTO。



***滑动窗口***

如果TCP数据包被一一发送并确认，则效率太低。尽管确保了可靠性，但是不能确保每次发送和确认一个数据包的效率。在这种情况下，需要一种`批量发送和确认`的方法，这就是滑动窗口的作用。

窗口的大小是指tcp协议一次传输多大的数据量。TCP是一个面向连接的可靠的传输协议，要实现这种可靠性需要对传输的结果进行确认。TCP窗口机制有两种，一种是固定窗口大小，另一种是滑动窗口。
 
数据传输时，TCP会对所有数据进行编号，发送方在发送过程中始终保持着一个窗口，只有落在发送窗口内的数据帧才允许被发送；同时接收方也始终保持着一个接收窗口，只有落在窗口内的数据才会被接收。这样通过改变发送窗口和接收窗口的大小就可以实现流量控制。


***拥塞控制***

TCP在传送数据时，第一次接受方窗口大小是由链路带宽决定的，但是接收方在接收到的数据后，返回ack确认报文，同时也告诉了发送方自己的窗口大小，此时发送方第二次发送数据时，会改变自己的窗口大小和接收方一致。

当窗口过大时，会导致不必要的数据来拥塞我们的链路，但是窗口太小时，会造成很大的延时，比如为1时，发送方每发送一个数据，接收方就会返回一个ack报文，在发送方未接收到接收方的确认报文ack之前不会进行下一次发送。


***三次握手和四次挥手***
***连线中断***


全双工字节流：全双工指TCP的收发是可以同时进行的，字节流指接收到的数据是以字节为基础单位。
字节、字、位、比特换算：1位=1比特(bit),1字节=8bit,1字=2字节=16bit


[a-detailed-introduction-to-tcp](https://dzone.com/articles/a-detailed-introduction-to-tcp)
[TCP面试题之滑动窗口原理](https://www.cnblogs.com/hujinshui/p/10472671.html)